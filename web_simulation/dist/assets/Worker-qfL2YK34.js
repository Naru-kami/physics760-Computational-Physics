(function(){var e;self.onmessage=function(n){let{data:r}=n;for(let n of r){if(`canvas`in n){let r=n.canvas.getContext(`2d`);r&&(r.imageSmoothingEnabled=!1),e=new t(n.canvas,n.width,n.height),e.initializeData(),e.render();continue}if(e){if(`method`in n){e[n.method].apply(e,n.parameters??[]);continue}if(`property`in n){e[n.property]=n.value;continue}}}};var t=class{#e;#t;#n;#r;#i=new Uint8Array(4608);#a;#o;#s;#c;#l;#u=1;constructor(e,t,n){this.#e=e,this.#t=new OffscreenCanvas(t,n),this.#n=new ImageData(t,n),this.#a=new Float64Array(t*n),this.#o=new Float64Array(t*n),this.#s=new Float64Array(t*n),this.#c=new Float64Array(t*n),this.#l=new Uint32Array(t*n);for(let e=0;e<this.#a.length;e++)this.#n.data[e*4+3]=255;this.record=!0,this.T=1,this.step=this.Metropolis,this.obs=this.Magnetization,this.#d();let r=new DOMMatrix().translateSelf(256,256).scaleSelf(512/t,512/n);this.#e.getContext(`2d`)?.setTransform(r)}setStep(e){this.step=this[e]}setObs(e){this.obs=this[e],this.#u=e===`Magnetization`?1:2;let t=this.#n.width,n=this.#n.height;this.#o=new Float64Array(t*n),this.#s=new Float64Array(t*n),this.#c=new Float64Array(t*n),this.#l=new Uint32Array(t*n),self.postMessage?.({observable:{y:Array(this.#o.length).fill(null)},variance:{y:Array(this.#c.length).fill(null)}})}resize(e,t){this.#t.width=e,this.#t.height=t;let n=new DOMMatrix().translateSelf(256,256).scaleSelf(512/e,512/t);this.#e.getContext(`2d`)?.setTransform(n),this.#n=new ImageData(e,t),this.#a=new Float64Array(e*t),this.#o=new Float64Array(e*t),this.#s=new Float64Array(e*t),this.#c=new Float64Array(e*t),this.#l=new Uint32Array(e*t);for(let e=0;e<this.#a.length;e++)this.#n.data[e*4+3]=255}initializeData(){for(let e=0;e<this.#n.height;e++)for(let t=0;t<this.#n.width;t++)this.#a[e*this.#n.width+t]=2*Math.PI*Math.random(),this.#o[e*this.#n.width+t]=0,this.#s[e*this.#n.width+t]=0,this.#c[e*this.#n.width+t]=0,this.#l[e*this.#n.width+t]=0;self.postMessage?.({observable:{y:Array(this.#o.length).fill(null)},variance:{y:Array(this.#c.length).fill(null)}})}initializeDataAligned(){let e=Math.random()*2*Math.PI;for(let t=0;t<this.#n.height;t++)for(let n=0;n<this.#n.width;n++)this.#a[t*this.#n.width+n]=e,this.#o[t*this.#n.width+n]=0,this.#s[t*this.#n.width+n]=0,this.#c[t*this.#n.width+n]=0,this.#l[t*this.#n.width+n]=0;self.postMessage?.({observable:{y:Array(this.#o.length).fill(null)},variance:{y:Array(this.#c.length).fill(null)}})}#d(){for(let e=0;e<1536;e++){let[t,r,i]=n((e+.5)/1536*2*Math.PI);this.#i[e*3+0]=Math.round(t*255),this.#i[e*3+1]=Math.round(r*255),this.#i[e*3+2]=Math.round(i*255)}}burnIn(){for(let e=0;e<100;e++)this.step()}play(e=0){this.#r=requestAnimationFrame(t=>{this.step(),this.record&&(this.recordData(),t-e>500&&(e=t,self.postMessage?.({T:Math.round(100*this.T)/100,observable:{y:Array.from(this.#o).map((e,t)=>this.#l[t]==0||e==0?null:e/this.#l[t])},variance:{y:Array.from(this.#c).map(e=>e||null)}}))),this.render(),this.play(e)})}pause(){this.#r&&cancelAnimationFrame(this.#r),this.#r=void 0,self.postMessage?.({observable:{y:Array.from(this.#o).map((e,t)=>this.#l[t]==0||e==0?null:e/this.#l[t])},variance:{y:Array.from(this.#c).map(e=>e||null)}})}sweep(e=performance.now()){if(this.T>2){this.T=2,self.postMessage?.({T:this.T,isPlaying:!1,observable:{y:Array.from(this.#o).map((e,t)=>this.#l[t]==0||e==0?null:e/this.#l[t])},variance:{y:Array.from(this.#c).map(e=>e||null)}}),this.#r&&cancelAnimationFrame(this.#r),this.#r=void 0;return}this.#r=requestAnimationFrame(t=>{for(let e=0;e<30;e++)this.step(),this.recordData();t-e>500&&(self.postMessage?.({T:this.T,observable:{y:Array.from(this.#o).map((e,t)=>this.#l[t]==0||e==0?null:e/this.#l[t])},variance:{y:Array.from(this.#c).map(e=>e||null)}}),this.render(),this.T=Math.round(100*this.T+1)/100,e=t,this.burnIn()),this.sweep(e)})}recordData(){let e=this.obs(),t=Math.round(100*this.T);this.#o[t]+=e,this.#s[t]+=e*e,this.#l[t]++,this.#c[t]=(this.#s[t]/this.#l[t]-(this.#o[t]/this.#l[t])**2)*this.#a.length/this.T**this.#u}Magnetization(){let e=0,t=0;for(let n=0;n<this.#a.length;n++)e+=Math.cos(this.#a[n]),t+=Math.sin(this.#a[n]);return Math.hypot(e,t)/this.#a.length}Energy(){let e=this.#n.width,t=this.#n.height,n=0;for(let r=0;r<t;r++)for(let i=0;i<e;i++)n-=Math.cos(this.#a[r*e+i]-this.#a[r*e+(i+1)%e])+Math.cos(this.#a[r*e+i]-this.#a[r*e+(i-1+e)%e])+Math.cos(this.#a[r*e+i]-this.#a[(r+1)%t*e+i])+Math.cos(this.#a[r*e+i]-this.#a[(r-1+t)%t*e+i]);return n/2/this.#a.length}Metropolis(){let e=this.#n.width,t=this.#n.height,n,r,i;for(let a=0;a<t;a++)for(let o=0;o<e;o++)n=-(Math.cos(this.#a[a*e+o]-this.#a[a*e+(o+1)%e])+Math.cos(this.#a[a*e+o]-this.#a[a*e+(o-1+e)%e])+Math.cos(this.#a[a*e+o]-this.#a[(a+1)%t*e+o])+Math.cos(this.#a[a*e+o]-this.#a[(a-1+t)%t*e+o])),i=2*Math.PI*Math.random(),r=-(Math.cos(this.#a[a*e+o]+i-this.#a[a*e+(o+1)%e])+Math.cos(this.#a[a*e+o]+i-this.#a[a*e+(o-1+e)%e])+Math.cos(this.#a[a*e+o]+i-this.#a[(a+1)%t*e+o])+Math.cos(this.#a[a*e+o]+i-this.#a[(a-1+t)%t*e+o])),(r<n||Math.random()<Math.exp(-(r-n)/this.T))&&(this.#a[a*e+o]=(this.#a[a*e+o]+i+2*Math.PI)%(2*Math.PI))}Wolff(){let e=this.#n.width,t=this.#n.height,n=Math.random()*2*Math.PI,r=new Set,i=new Set,a=new Uint32Array(4),o=0,s=0,c,l;do{i.clear(),r.clear(),r.add(Math.floor(Math.random()*t)*e+Math.floor(Math.random()*e));for(let o of r.values()){this.#a[o]=(2*n-this.#a[o]+3*Math.PI)%(2*Math.PI),c=o%e,l=Math.floor(o/e),a[0]=(l-1+t)%t*e+c,a[1]=l*e+(c+1)%e,a[2]=(l+1)%t*e+c,a[3]=l*e+(c-1+e)%e;for(let e of a)!i.has(e)&&!r.has(e)&&Math.random()<1-Math.exp(Math.min(0,2/this.T*Math.cos(n-this.#a[o])*Math.cos(n-this.#a[e])))&&r.add(e);i.add(o),r.delete(o)}s++,o+=i.size}while(o*(1+1/s)<this.#a.length)}render(){if(!this.#e)return;let e=this.#n.width,t=this.#n.height,n=1536/(2*Math.PI),r;for(let e=0;e<this.#a.length;e++)r=Math.floor(this.#a[e]*n)*3,this.#n.data[e*4+0]=this.#i[r+0],this.#n.data[e*4+1]=this.#i[r+1],this.#n.data[e*4+2]=this.#i[r+2];this.#t.getContext(`2d`)?.putImageData(this.#n,0,0),this.#e.getContext(`2d`)?.drawImage(this.#t,-e/2,-t/2)}};function n(e,t=1,n=.5){e*=180/Math.PI;let r=t*Math.min(n,1-n),i=(t,i=(t+e/30)%12)=>n-r*Math.max(Math.min(i-3,9-i,1),-1);return[i(0),i(8),i(4)]}})();